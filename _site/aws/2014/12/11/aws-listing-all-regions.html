<!DOCTYPE html>
<html>
  <head>
    <title>p8952 - Listing EC2 instances in all regions</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/res/img/favicon.png"/>
    <link href="/res/css/bootstrap.min.css" rel="stylesheet">
    <link href="/res/css/font-awesome.min.css" rel="stylesheet">
    <link href="/res/css/style.css" rel="stylesheet">
    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-57627294-1', 'auto');
ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="header">
      <h3>
        <strong><a href="/index.html">p8952</a></strong>
        <div class="pull-right">
        <a href="/projects.html">Code</a>|
        <a href="/notes.html">Notes</a>|
        <a href="/photography.html">Photos</a>
        </div>
      </h3>
    </div>
    <br>
    <br>
    <h3>Listing EC2 Instances in All Regions</h3>
<p>When working with EC2 instances across multiple regions I&#39;ve found it&#39;s near
impossible to get a good overview of what is running where. This can be
especially annoying when you are automatically launching a number of short
lived instances.</p>

<p>To prevent me having to go through 9 different web pages to see what I
currently have running I found it easier to just use the API and list active
instances from the CLI.</p>

<p>Install dependencies:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ gem install aws-sdk pmap
</code></pre></div>
<p>/usr/local/bin/aws-list:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#!/usr/bin/ruby

require &#39;aws-sdk&#39;
require &#39;pmap&#39;

def ec2(region = &#39;us-east-1&#39;)
    ec2 = AWS::EC2.new(
        access_key_id: ENV[&#39;AWS_ACCESS_KEY&#39;],
        secret_access_key: ENV[&#39;AWS_SECRET_KEY&#39;],
        region: region
    )
    ec2
end

def list_instances
    instances = []
    ec2.regions.peach do |region|
        ec2.regions[region.name].instances.peach do |instance|
            next if instance.status == :terminated
            instances &lt;&lt; instance
        end
    end
    instances
end

list_instances.peach do |instance|
    puts &quot;#{instance.id}\t\t#{instance.availability_zone}\t\t#{instance.status}\t\t#{instance.ip_address}\n&quot;
end
</code></pre></div>
<p>Listing instances:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ export AWS_ACCESS_KEY=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;
$ export AWS_SECRET_KEY=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;
$ aws-list
i-16b78754          eu-west-1a          running         54.77.218.113
i-0025e1e6          eu-west-1a          running         54.76.129.127
i-3926e2df          eu-west-1a          running         54.154.52.146
i-4924e0af          eu-west-1a          running         54.154.52.77
i-c424e022          eu-west-1a          running         54.72.131.127
i-0c25e1ea          eu-west-1a          running         54.154.51.140
i-9c25e17a          eu-west-1a          running         54.154.49.204
i-4b24e0ad          eu-west-1a          running         54.77.225.135
i-33e929f2          eu-central-1b       running         54.93.164.233
i-c324e025          eu-west-1a          running         54.76.98.165
i-3f26e2d9          eu-west-1a          running         54.154.47.126
i-8027e366          eu-west-1a          running         54.154.20.140
i-0d25e1eb          eu-west-1a          running         54.77.100.132
i-d718edd9          us-west-2c          running         54.149.35.63
i-0c2028e6          us-east-1a          running         54.164.193.104
i-5b95e54e          sa-east-1a          running         54.94.165.7
i-2dad38de          ap-northeast-1a     running         54.65.157.129
i-625a80af          ap-southeast-1a     running         54.169.195.201
i-a06e006f          ap-southeast-2a     running         54.66.184.34
i-2dbce5e5          us-west-1a          running         54.67.67.18
</code></pre></div>


<hr>
<small>December 11, 2014</small>




  </body>
</html>
