<!DOCTYPE html>
<html>
  <head>
    <title>p8952 - Installing Vagrant in non-supported environments</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/res/img/favicon.png"/>
    <link href="/res/css/bootstrap.min.css" rel="stylesheet">
    <link href="/res/css/font-awesome.min.css" rel="stylesheet">
    <link href="/res/css/style.css" rel="stylesheet">
    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-57627294-1', 'auto');
ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="header">
      <h3>
        <strong><a href="/index.html">p8952</a></strong>
        <div class="pull-right">
          <a href="/projects.html">Code</a>|<a href="/notes.html">Notes</a>|<a href="/photography.html">Photos</a>
        </div>
      </h3>
    </div>
    <br>
    <br>
    <h3>Installing Vagrant in Non-Supported Environments</h3>
<p>Get sources:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ git clone git@github.com:mitchellh/vagrant.git
$ cd vagrant
$ git checkout tags/v1.6.5
</code></pre></div>
<p>Install dependencies:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ gem install bundler -v &#39;&lt; 1.7.0&#39;
$ bundle _1.6.9_ install
</code></pre></div>
<p>Patch Vagrant[1][2][3]:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">diff --git a/bin/vagrant b/bin/vagrant
index 21630e1..5e24279 100755
--- a/bin/vagrant
+++ b/bin/vagrant
@@ -66,6 +66,8 @@ end

 # Setup our dependencies by initializing Bundler. If we&#39;re using plugins,
 # then also initialize the paths to the plugins.
+load_path = []
+$LOAD_PATH.each { |path| load_path &lt;&lt; path }
 require &quot;bundler&quot;
 begin
   Bundler.setup(:default, :plugins)
@@ -94,6 +96,7 @@ rescue Bundler::VersionConflict =&gt; e
   $stderr.puts e.message
   exit 1
 end
+load_path.each { |path| $LOAD_PATH.push(path) unless $LOAD_PATH.include?(path) }

 # Stdout/stderr should not buffer output
 $stdout.sync = true
@@ -164,11 +167,6 @@ begin
   logger.debug(&quot;Creating Vagrant environment&quot;)
   env = Vagrant::Environment.new(opts)

-  if !Vagrant.in_installer? &amp;&amp; !Vagrant.very_quiet?
-    # If we&#39;re not in the installer, warn.
-    env.ui.warn(I18n.t(&quot;vagrant.general.not_in_installer&quot;) + &quot;\n&quot;, prefix: false)
-  end
-
   begin
     # Execute the CLI interface, and exit with the proper error code
     exit_status = env.cli(argv)
diff --git a/lib/vagrant/bundler.rb b/lib/vagrant/bundler.rb
index 05867da..54f9fb8 100644
--- a/lib/vagrant/bundler.rb
+++ b/lib/vagrant/bundler.rb
@@ -18,8 +18,7 @@ module Vagrant
     end

     def initialize
-      @enabled = true if ENV[&quot;VAGRANT_INSTALLER_ENV&quot;] ||
-        ENV[&quot;VAGRANT_FORCE_BUNDLER&quot;]
+      @enabled  = true
       @enabled  = !::Bundler::SharedHelpers.in_bundle? if !@enabled
       @monitor  = Monitor.new

---
</code></pre></div>
<p>Test and install:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ bundle _1.6.9_ exec rake test:unit
$ bundle _1.6.9_ exec rake install
</code></pre></div>
<p>[1]: Without this patch Vagrant will give the following warning:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ vagrant status
You appear to be running Vagrant outside of the official installers.
Note that the installers are what ensure that Vagrant has all required
dependencies, and Vagrant assumes that these dependencies exist. By
running outside of the installer environment, Vagrant may not function
properly. To remove this warning, install Vagrant using one of the
official packages from vagrantup.com.
</code></pre></div>
<p>[2]: Without this patch Vagrant will give the following error:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ vagrant plugin install vagrant-aws
Installing the &#39;vagrant-aws&#39; plugin. This can take a few minutes...
Vagrant&#39;s built-in bundler management mechanism is disabled because
Vagrant is running in an external bundler environment. In these
cases, plugin management does not work with Vagrant. To install
plugins, use your own Gemfile. To load plugins, either put the
plugins in the `plugins` group in your Gemfile or manually require
them in a Vagrantfile.
</code></pre></div>
<p>[3]: Without this patch Vagrant will give an <a href="https://github.com/mitchellh/vagrant/issues/5172">error when running in a directory
containing a Gemfile</a>.</p>




<small>December 08, 2014</small>

  </body>
</html>
